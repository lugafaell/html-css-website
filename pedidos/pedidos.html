<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ITMF - Pedidos</title>
  <link rel="icon" href="../imgs/116767489_289311779001162_8843699157529714928_n.jpg" type="image/x-icon">
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />

  <style>
    #background-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      background-color: #017f2d;
      background-size: 40%;
      background-position: center;
      background-repeat: no-repeat;
    }

    /* Estilos para o contêiner do conteúdo principal */
    .content-container {
      position: relative;
      z-index: 1;
      /* Garante que o conteúdo principal fique acima da imagem de fundo */
      padding: 20px;
      /* Adapte conforme necessário */
    }

    .navbar {
      transition: all 0.3s ease;
    }

    .forms {
      transition: all 0.3s ease;
    }

    .fade-in {
      animation: fadeIn 1s ease-in-out;
      opacity: 0;
      animation-fill-mode: forwards;
    }

    @keyframes fadeIn {
      0% {
        opacity: 0;
      }

      100% {
        opacity: 1;
      }
    }

.select2-container .select2-selection--single {
    width: 100%; /* Certifique-se de que o Select2 ocupa 100% da largura disponível */
    padding: 0.375rem 0.75rem;
    height: calc(1.5em + 0.75rem + 2px);
    font-size: 1rem;
    font-weight: 400;
    line-height: 1.5;
    color: #495057;
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid #ced4da;
    border-radius: 0.25rem;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    display: flex; /* Adiciona flex para melhor controle do alinhamento interno */
    align-items: center; /* Alinha o conteúdo centralmente */
}

.select2-container--default .select2-selection--single .select2-selection__arrow {
    height: calc(1.5em + 0.75rem);
    margin-top: 0; /* Remove qualquer margem superior para melhor alinhamento */
    display: flex;
    align-items: center; /* Alinha a seta centralmente */
}

.select2-container .select2-dropdown {
    max-height: 200px;
    overflow-y: auto;
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
}

.select2-container--default .select2-selection--single .select2-selection__rendered {
    display: flex;
    align-items: center; /* Garante que o texto dentro do Select2 esteja alinhado ao centro */
    padding: 0; /* Remove padding interno para evitar quebra de layout */
    height: 100%;
}
  </style>
</head>

<body>
  <div id="background-container"></div>

  <nav class="navbar bg-dark" id="menu" style="position: relative; box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.1);">
    <div class="container-fluid">
      <button class="navbar-toggler bg-success" type="button" data-bs-toggle="offcanvas"
        data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
        <span class="navbar-toggler-icon"></span>
      </button>
      <img src="../imgs/Imagem_do_WhatsApp_de_2024-04-30_à_s__12.53.06_24f6df1d-removebg-preview.png" width="30"
        height="30" class="d-inline-block align-top" alt="">

      <div class="offcanvas offcanvas-start bg-dark" tabindex="-1" id="offcanvasNavbar"
        aria-labelledby="offcanvasNavbarLabel">
        <div class="offcanvas-header">
          <h3 class="text-white" id="userName"></h3>
          <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a class="nav-link text-white" href="tabelaPedidos.html">Lista de Pedidos</a>
            </li>
            <li id="faturamento" class="nav-item">
              <a class="nav-link text-white" href="../faturamento/faturamento.html">Pendentes de Faturamento</a>
            </li>
            <li id="pedidosCancelados" class="nav-item">
              <a class="nav-link text-white" href="../cancelados/tabelaPedidosCancelados.html">Pedidos Cancelados</a>
            </li>
            <li id="dashboard" class="nav-item">
              <a class="nav-link text-white" href="../pedidos/dashboard.html">Dashboard</a>
            </li>
            <li id="cadastroFuncionario" class="nav-item">
              <a class="nav-link text-white" href="../pedidos/cadastroFuncionario.html">Cadastro Itens</a>
            </li>
            <li id="equipamentosOpme" class="nav-item">
              <a class="nav-link text-white" href="../pedidos/equipamentosOpme.html">Cadastro Itens</a>
            </li>
            <li class="nav-item">
              <a class="nav-link mt-auto text-white" href="#" onclick="logout()">Sair</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <div class="container mt-5">
    <div class="card bg-dark shadow forms fade-in">
      <div class="card-body text-white">
        <h2 class="card-title text-center mb-4">Formulário de Pedidos</h2>
        <form>

          <div class="row mb-3">
            <div class="col-md-4">
              <label for="hospital" class="form-label">Hospital</label>
              <select class="form-select custom-select2-container" id="hospital">
                <option selected disabled>Selecione...</option>
                <option value="São Carlos">São Carlos</option>
                <option value="São Mateus">São Mateus</option>
                <option value="São Camilo">São Camilo</option>
                <option value="Unimed">Unimed</option>
                <option value="UNIMED CARIRI">UNIMED CARIRI</option>
                <option value="UNIMED TERESINA">UNIMED TERESINA</option>
                <option value="UNIMED PRIMAVERA">UNIMED PRIMAVERA</option>
                <option value="Monte klinikum">Monte klinikum</option>
                <option value="São Raimundo">São Raimundo</option>
                <option value="HGeF">HGeF</option>
                <option value="ICC">ICC</option>
                <option value="Otoclinica">Otoclinica</option>
                <option value="Gastroclinica">Gastroclinica</option>
                <option value="Protocardio">Protocardio</option>
                <option value="HOSPITAL CARDIO ALIANÇA">
                  HOSPITAL CARDIO ALIANÇA
                </option>
                <option value="IOF">IOF</option>
                <option value="Antonio Prudente">Antonio Prudente</option>
                <option value="União de Clinicas do Ceará">
                  União de Clinicas do Ceará
                </option>
                <option value="Central de Fortaleza">
                  Central de Fortaleza
                </option>
                <option value="HUWC e MEAC">HUWC e MEAC</option>
                <option value="Universitário de São Luís">
                  Universitário de São Luís
                </option>
                <option value="Universitário da universidade federal do Piauí">
                  Universitário da universidade federal do Piauí
                </option>
                <option value="Geral de Fortaleza">Geral de Fortaleza</option>
                <option value="Messejana">Messejana</option>
                <option value="FUNDES">FUNDES</option>
                <option value="SANTA CASA">SANTA CASA</option>
                <option value="MULTICLIN HOSPITAL DIA">
                  MULTICLIN HOSPITAL DIA
                </option>
                <option value="G.O CLINIC">G.O CLINIC</option>
                <option value="Hospital Genesis">Hospital Genesis</option>
                <option value="Clinica Digestive">Clinica Digestive</option>
                <option value="HDOC - Hosp. Dr. Oswaldo Cruz">
                  HDOC - Hosp. Dr. Oswaldo Cruz
                </option>
                <option value="Hospital Batista Memorial">
                  Hospital Batista Memorial
                </option>
                <option value="HGF - HOSPITAL DO EXERCITO">
                  HGF - HOSPITAL DO EXERCITO
                </option>
                <option value="HOSPITAL MENINO JESUS">
                  HOSPITAL MENINO JESUS
                </option>
                <option value="ISGH">ISGH</option>
                <option value="WALTER CANTIDIO">WALTER CANTIDIO</option>
                <option value="CLINICA LEVITA MEDICINA E SAUDE">
                  CLINICA LEVITA MEDICINA E SAUDE
                </option>
                <option value="HOSPITAL JÓRIO DA ESCÓSSIA">
                  HOSPITAL JÓRIO DA ESCÓSSIA
                </option>
                <option value="Unimed Sul">Unimed Sul</option>
                <option value="HOSPITAL LEVITA">HOSPITAL LEVITA</option>
                <option value="HOSPITAL DA POLICIA MILITAR">
                  HOSPITAL DA POLICIA MILITAR
                </option>
                <option value="CLINICA DIVINA LUZ">CLINICA DIVINA LUZ</option>
                <option value="ABEMP - ASSOCIAÇÃO BENEFICENTE MÉDICA PAJUÇARA">
                  ABEMP - ASSOCIAÇÃO BENEFICENTE MÉDICA PAJUÇARA
                </option>
                <option value="PRONTOCARDIO">PRONTOCARDIO</option>
                <option value="HOSPITAL SANTA MARIA">
                  HOSPITAL SANTA MARIA
                </option>
                <option value="CLÍNICA UNIQUE">CLÍNICA UNIQUE</option>
                <option value="SÃO MARCOS">SÃO MARCOS</option>
                <option value="UNIMED TERESINA">UNIMED TERESINA</option>
                <option value="Centro de Cardiologia HSD">
                  Centro de Cardiologia HSD
                </option>
                <option value="CEMED">CEMED</option>
                <option value="Centro Medico Maranhece">
                  Centro Medico Maranhece
                </option>
                <option value="Clinica São José">Clinica São José</option>
                <option value="Clinica São Marcos">Clinica São Marcos</option>
                <option value="Fundação Antônio Jorge Dino">
                  Fundação Antônio Jorge Dino
                </option>
                <option value="GEAP">GEAP</option>
                <option value="HCI">HCI</option>
                <option value="Hospital Tarquínio Lopes">
                  Hospital Tarquínio Lopes
                </option>
                <option value="Hospital Carlos Macieira">
                  Hospital Carlos Macieira
                </option>
                <option value="Hospital Esperança UDI">
                  Hospital Esperança UDI
                </option>
                <option value="Hospital Guarás">Hospital Guarás</option>
                <option value="Hospital São Domingos">
                  Hospital São Domingos
                </option>
                <option value="Hospital Universitário Pres. Dutra">
                  Hospital Universitário Pres. Dutra
                </option>
                <option value="Image HSD">Image HSD</option>
                <option value="Sogastro">Sogastro</option>
                <option value="Unihosp">Unihosp</option>
                <option value="Urocentro">Urocentro</option>
                <option value="HOSPITAL SAO LUIS - HSLZ LTDA.">
                  HOSPITAL SAO LUIS - HSLZ LTDA.
                </option>
                <option value="HOSPITAL ALDENORA BELO">
                  HOSPITAL ALDENORA BELO
                </option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="linha" class="form-label">Linha</label>
              <select class="form-select custom-select2-container" id="linha">
                <option selected disabled>Selecione...</option>
                <option value="GERAL">GERAL</option>
                <option value="VASCULAR">VASCULAR</option>
                <option value="UROLOGIA">UROLOGIA</option>
                <option value="CARDÍACA">CARDÍACA</option>
                <option value="GERAL / VASCULAR">GERAL / VASCULAR</option>
                <option value="GERAL / CARDÍACA">GERAL / CARDÍACA</option>
                <option value="GERAL / UROLOGIA">GERAL / UROLOGIA</option>
                <option value="VASCULAR / CARDÍACA">
                  VASCULAR / CARDÍACA
                </option>
                <option value="VASCULAR / UROLOGIA">
                  VASCULAR / UROLOGIA
                </option>
                <option value="CARDÍACA / UROLOGIA">
                  CARDÍACA / UROLOGIA
                </option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="dataProcedimento" class="form-label">Data do Procedimento</label>
              <input type="date" class="form-control" id="dataProcedimento" />
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-4">
              <label for="horaProcedimento" class="form-label">Hora do Procedimento</label>
              <input type="time" class="form-control" id="horaProcedimento" />
            </div>
            <div class="col-md-4">
              <label for="instrumentador" class="form-label">Instrumentador</label>
              <select class="form-select" id="instrumentador">
                <option selected disabled>Selecione...</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="convenio" class="form-label">Convênio</label>
              <select class="form-select custom-select2-container" id="convenio">
                <option selected disabled>Selecione...</option>
                <option value="UNIMED">UNIMED</option>
                <option value="HAPVIDA">HAPVIDA</option>
                <option value="EMSERH">EMSERH</option>
                <option value="PARTICULAR">PARTICULAR</option>
                <option value="CAFAZ">CAFAZ</option>
                <option value="ASSEFAZ">ASSEFAZ</option>
                <option value="FUSEX">FUSEX</option>
                <option value="GEAP CE">GEAP CE</option>
                <option value="GEAP PI">GEAP PI</option>
                <option value="GEAP MA">GEAP MA</option>
                <option value="GEAP PA">GEAP PA</option>
                <option value="BANCO CENTRAL">BANCO CENTRAL</option>
                <option value="ISSEC">ISSEC</option>
                <option value="BRADESCO CENTRAL">BRADESCO CENTRAL</option>
                <option value="PAS">PAS</option>
                <option value="IPM">IPM</option>
                <option value="AMIL">AMIL</option>
                <option value="CASSI">CASSI</option>
                <option value="FUNSA">FUNSA</option>
                <option value="SUS">SUS</option>
                <option value="CNU">CNU</option>
                <option value="CAMED">CAMED</option>
                <option value="CAPSESP">CAPSESP</option>
                <option value="SULAMERICA">SULAMERICA</option>
                <option value="AERONÁUTICA">AERONÁUTICA</option>
                <option value="FUSMA">FUSMA</option>
                <option value="LIV SAUDE">LIV SAUDE</option>
                <option value="PETROBRAS">PETROBRAS</option>
                <option value="CAPESAÚDE">CAPESAÚDE</option>
                <option value="POSTAL SAUDE">POSTAL SAUDE</option>
                <option value="VALE">VALE</option>
                <option value="VENDA DIRETA">VENDA DIRETA</option>
                <option value="CONSIGNAÇÃO">CONSIGNAÇÃO</option>
                <option value="CAIXA">CAIXA</option>
                <option value="PLANO ECONOMICO">PLANO ECONOMICO</option>
                <option value="INTERMED">INTERMED</option>
                <option value="CIRURGIA JÁ!">CIRURGIA JÁ!</option>
                <option value="LICITAÇÃO">LICITAÇÃO</option>
                <option value="DOAÇÃO">DOAÇÃO</option>
                <option value="FACHESF">FACHESF</option>
                <option value="SAUDE CAIXA">SAUDE CAIXA</option>
                <option value="MEDISERVICE">MEDISERVICE</option>
                <option value="ABEAS">ABEAS</option>
              </select>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-4">
              <label for="medico" class="form-label">Médico</label>
              <select class="form-select custom-select2-container" id="medico">
                <option selected disabled>Selecione...</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="nomePaciente" class="form-label">Nome do Paciente</label>
              <input type="text" class="form-control" id="nomePaciente" oninput="toUpperCase()" />
            </div>
            <div class="col-md-4">
              <label for="responsabilidade" class="form-label">Responsabilidade de Esterilização</label>
              <select class="form-select" id="responsabilidade">
                <option selected disabled>Selecione...</option>
                <option value="CLIENTE">CLIENTE</option>
                <option value="ITMF">ITMF</option>
              </select>
            </div>
          </div>
          <div class="row mb-3">
            <div class="col-md-4">
              <label for="tipoProcedimento" class="form-label">Tipo de Procedimento</label>
              <select class="form-select" id="tipoProcedimento">
                <option>Selecione...</option>
                <option value="RTU BIPOLAR">RTU BIPOLAR</option>
                <option value="REFLUXO GASTRICO">REFLUXO GASTRICO</option>
                <option value="HISTERECTOMIA">HISTERECTOMIA</option>
                <option value="HISTEROSCOPIA">HISTEROSCOPIA</option>
                <option value="RETOSSIGMOIDOCTOMIA">
                  RETOSSIGMOIDOCTOMIA
                </option>
                <option value="GASTRECTOMIA">GASTRECTOMIA</option>
                <option value="VASECTOMIA">VASECTOMIA</option>
                <option value="ANGIOPLASTIA">ANGIOPLASTIA</option>
                <option value="NEFRECTOMIA">NEFRECTOMIA</option>
                <option value="URETERO FLEXIVEL">URETERO FLEXIVEL</option>
                <option value="URETERO RIGIDO">URETERO RIGIDO</option>
                <option value="OOFORECTOMIA">OOFORECTOMIA</option>
                <option value="COLESCISTECTOMIA">COLESCISTECTOMIA</option>
                <option value="PROSTATECTOMIA">PROSTATECTOMIA</option>
                <option value="LAPAROTOMIA">LAPAROTOMIA</option>
                <option value="CISTONEFROSCOPIO">CISTONEFROSCOPIO</option>
                <option value="CISTOLITOTRIPSIA">CISTOLITOTRIPSIA</option>
                <option value="PERCUTANEA">PERCUTANEA</option>
                <option value="BARIATRICA">BARIATRICA</option>
                <option value="TIREOIDECTOMIA">TIREOIDECTOMIA</option>
                <option value="REVASCULARIZAÇÃO DO MIOCARDIO">
                  REVASCULARIZAÇÃO DO MIOCARDIO
                </option>
                <option value="LOBECTOMIA">LOBECTOMIA</option>
                <option value="CISTOPLASTIA">CISTOPLASTIA</option>
                <option value="CONSIGNAÇÃO">CONSIGNAÇÃO</option>
                <option value="VENDA DIRETA">VENDA DIRETA</option>
                <option value="COLECTOMIA">COLECTOMIA</option>
                <option value="HERNIORRAFIA">HERNIORRAFIA</option>
                <option value="REPOSIÇÃO">REPOSIÇÃO</option>
                <option value="OUTROS">OUTROS</option>
                <option value="RETIRADA DE DUPLO J">
                  RETIRADA DE DUPLO J
                </option>
                <option value="THULEP">THULEP</option>
                <option value="URETROTOMIA">URETROTOMIA</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="vendedor" class="form-label">Vendedor</label>
              <select class="form-select" id="vendedor">
                <option selected disabled>Selecione...</option>
              </select>
            </div>
          </div>
          <div class="row mb-3" id="camposEquipamento">
            <div class="col-md-4">
              <label for="equipamento" class="form-label">Equipamento</label>
              <select id="equipamentoSelect" class="form-select custom-select2-container" name="equipamento[]">
                <option selected disabled>Selecione...</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="quantidadeEquipamento" class="form-label">Quantidade do Equipamento</label>
              <input type="number" class="form-control" name="quantidadeEquipamento[]" />
            </div>
            <div class="col-md-4 d-flex align-items-end mt-2">
              <button type="button" class="btn btn-success me-2"
                onclick="adicionarCampo('camposEquipamento', 'equipamento[]', 'quantidadeEquipamento[]', 'Equipamento', 'Quantidade do Equipamento')">
                Adicionar
              </button>
              <button type="button" class="btn btn-danger" onclick="removerUltimoCampo('camposEquipamento')">
                Remover
              </button>
            </div>
          </div>

          <div id="novosEquipamentos"></div>
          <div class="row mb-3" id="camposMaterial">
            <div class="col-md-4">
              <label for="material" class="form-label">Material</label>
              <select id="materialSelect" class="form-select custom-select2-container" name="material[]">
                <option selected disabled>Selecione...</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="quantidadeMaterial" class="form-label">Quantidade do Material</label>
              <input type="number" class="form-control" name="quantidadeMaterial[]" />
            </div>
            <div class="col-md-4 d-flex align-items-end mt-2">
              <button type="button" class="btn btn-success me-2"
                onclick="adicionarCampo('camposMaterial', 'material[]', 'quantidadeMaterial[]', 'Material', 'Quantidade do Material')">
                Adicionar
              </button>
              <button type="button" class="btn btn-danger" onclick="removerUltimoCampo('camposMaterial')">
                Remover
              </button>
            </div>
          </div>

          <div id="novosMateriais"></div>

          <div class="row mb-3">
            <div class="col-md-12 d-flex justify-content-end">
              <button type="submit" class="btn btn-success" onclick="registrar(event)">
                Enviar
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
    integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
    integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
    crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script>
    function logout() {
      localStorage.removeItem('token');

      localStorage.removeItem('userEmail');

      window.location.href = '../login/tela_login.html';
    }

    document.addEventListener('DOMContentLoaded', function () {

      const tipoProcedimentoSelect = document.getElementById('tipoProcedimento');

      tipoProcedimentoSelect.addEventListener('change', function () {
        const procedimentoSelecionado = this.value;
        atualizarSelects(procedimentoSelecionado);
      });

      fetch('https://api.itmf.app.br/funcionario/funcionarios?cargo=Vendedor')
        .then(response => response.json())
        .then(data => {
          const vendedorSelect = document.getElementById('vendedor');
          data.forEach(funcionario => {
            const option = document.createElement('option');
            option.value = funcionario.nomeFuncionario;
            option.textContent = funcionario.nomeFuncionario;
            vendedorSelect.appendChild(option);
          });
        })
        .catch(error => console.error('Erro ao buscar funcionários:', error));

      fetch('http://localhost:3000/funcionario/funcionarios?cargo=Instrumentador')
        .then(response => response.json())
        .then(data => {
          const vendedorSelect = document.getElementById('instrumentador');
          data.forEach(funcionario => {
            const option = document.createElement('option');
            option.value = funcionario.nomeFuncionario;
            option.textContent = funcionario.nomeFuncionario;
            vendedorSelect.appendChild(option);
          });
        })
        .catch(error => console.error('Erro ao buscar funcionários:', error));

      fetch('https://api.itmf.app.br/funcionario/funcionarios?cargo=Médico')
        .then(response => response.json())
        .then(data => {
          const vendedorSelect = document.getElementById('medico');
          data.forEach(funcionario => {
            const option = document.createElement('option');
            option.value = funcionario.nomeFuncionario;
            option.textContent = funcionario.nomeFuncionario;
            vendedorSelect.appendChild(option);
          });
        })
        .catch(error => console.error('Erro ao buscar funcionários:', error));

      const userEmail = localStorage.getItem('userEmail');
      const token = localStorage.getItem('token');
      const cargo = localStorage.getItem('cargo');

      if (cargo === "Logistica" || cargo === "Vendedor") {
        const faturamento = document.getElementById('faturamento');

        faturamento.style.display = 'none';
      }

      if (cargo === "Vendedor" || cargo === "Comercial") {
        const cancelados = document.getElementById('pedidosCancelados');

        cancelados.style.display = 'none';
      }

      if (cargo === "Vendedor" || cargo === "Comercial" || cargo === "Comercial2" || cargo === "Logistica") {
        const dashboard = document.getElementById('dashboard');

        dashboard.style.display = 'none';
      }

      if (cargo === "Vendedor" || cargo === "Comercial" || cargo === "Comercial2" || cargo === "Logistica") {
        const equipamentosOpme = document.getElementById('equipamentosOpme');

        equipamentosOpme.style.display = 'none';
      }

      if (!token) {
        // Se não houver token, redireciona para a página de login
        window.location.href = '../login/tela_login.html';
      }

      // Atualize o conteúdo do elemento no menu com o valor do email
      if (userEmail !== null) {
        document.getElementById('userName').textContent = `Bem-Vindo, ${userEmail}`;
      } else {
        // Caso o email seja nulo ou indefinido, exiba uma saudação padrão
        document.getElementById('userName').textContent = 'Bem-Vindo, Usuário';
      }

      $(document).ready(function () {
        $(".custom-select2-container").select2({
          theme: "bootstrap5",
          width: "100%",
        });
      });
    });

    function atualizarSelects(procedimentoSelecionado) {

      let equipamentoURL = 'https://api.itmf.app.br/item/itens?tipo=EQUIPAMENTO';
      let materialURL = 'https://api.itmf.app.br/item/itens?tipo=OPME';

      if (procedimentoSelecionado && procedimentoSelecionado !== 'Selecione...') {
        equipamentoURL += `&procedimento=${procedimentoSelecionado}`;
        materialURL += `&procedimento=${procedimentoSelecionado}`;
      }

      fetch(equipamentoURL)
        .then(response => response.json())
        .then(data => {
          const equipamentoSelect = document.getElementById('equipamentoSelect');
          equipamentoSelect.innerHTML = '<option selected disabled>Selecione...</option>';
          data.forEach(item => {
            const option = document.createElement('option');
            option.value = item.nomeItem + " " + item.codeItem;
            option.textContent = item.nomeItem + " " + item.codeItem;
            equipamentoSelect.appendChild(option);
          });
        })
        .catch(error => console.error('Erro ao buscar Equipamentos:', error));

      fetch(materialURL)
        .then(response => response.json())
        .then(data => {
          const materialSelect = document.getElementById('materialSelect');
          materialSelect.innerHTML = '<option selected disabled>Selecione...</option>';
          data.forEach(item => {
            const option = document.createElement('option');
            option.value = item.nomeItem + " " + item.codeItem;
            option.textContent = item.nomeItem + " " + item.codeItem;
            materialSelect.appendChild(option);
          });
        })
        .catch(error => console.error('Erro ao buscar Materiais:', error));
    }

    function toUpperCase() {
      var input = document.getElementById("nomePaciente");
      input.value = input.value.toUpperCase();
    }

    function formatDate(date) {
      const formattedDate = new Date(date);
      const year = formattedDate.getFullYear();
      const month = String(formattedDate.getMonth() + 1).padStart(2, "0");
      const day = String(formattedDate.getDate()).padStart(2, "0");
      return `${year}-${month}-${day}`;
    }

    function getCurrentTime() {
      const now = new Date();
      const hours = String(now.getHours()).padStart(2, "0");
      const minutes = String(now.getMinutes()).padStart(2, "0");
      const seconds = String(now.getSeconds()).padStart(2, "0");
      return `${hours}:${minutes}:${seconds}`;
    }

    async function obterDatasRegistradas() {
      try {
        const token = localStorage.getItem('token');
        if (!token) {
          // Se não houver token, redirecione para a página de login
          window.location.href = '../login/tela_login.html';
          return;
        }

        const response = await axios.get('https://api.itmf.app.br/agenda/datasRegistradas', {
          headers: {
            Authorization: `Bearer ${token}`
          }
        });

        return response.data;
      } catch (error) {
        console.error('Erro ao obter datas registradas:', error);
        return null;
      }
    }

    function isDataDentroDoPrazo(dataProcedimento, dataInicio, dataFinal) {
      const dataProcedimentoDate = new Date(dataProcedimento);
      const dataInicioDate = new Date(dataInicio);
      const dataFinalDate = new Date(dataFinal);

      return dataProcedimentoDate >= dataInicioDate && dataProcedimentoDate <= dataFinalDate;
    }

    function validarCampos() {
      const camposObrigatorios = [
        "hospital",
        "linha",
        "dataProcedimento",
        "horaProcedimento",
        "medico",
        "nomePaciente",
        "responsabilidade",
        "tipoProcedimento",
        "vendedor",
        "instrumentador",
        "convenio"
      ];

      for (const campoId of camposObrigatorios) {
        const campo = document.getElementById(campoId);
        if (!campo || !campo.value.trim()) {
          return false;
        }
      }

      return true;
    }

    async function registrar(event) {
      event.preventDefault();

      const username = localStorage.getItem("userEmail"); // Recupera o nome do usuário do localStorage
      const url = `https://api.itmf.app.br/auth/users/${username}`;

      fetch(url)
        .then(response => response.json())
        .then(async (userData) => {
          const estado = userData.estado; // Obtém o estado do usuário
          const tipoProcedimento = document.getElementById("tipoProcedimento").value;
          const dataProcedimento = document.getElementById("dataProcedimento").value;

          if (!validarCampos()) {
            alert("Por favor, preencha todos os campos obrigatórios.");
            return;
          }

          // Verificar se o tipo de procedimento é "THULEP"
          if (tipoProcedimento === "THULEP") {
            const datasRegistradas = await obterDatasRegistradas();

            if (!datasRegistradas) {
              alert("Erro ao obter datas registradas. Tente novamente.");
              return;
            }

            let dentroDoPrazo = false;

            if (estado === "CE") {
              dentroDoPrazo = isDataDentroDoPrazo(dataProcedimento, datasRegistradas.dataInicioCE, datasRegistradas.dataFinalCE);
            } else if (estado === "PI") {
              dentroDoPrazo = isDataDentroDoPrazo(dataProcedimento, datasRegistradas.dataInicioPI, datasRegistradas.dataFinalPI);
            } else if (estado === "MA") {
              dentroDoPrazo = isDataDentroDoPrazo(dataProcedimento, datasRegistradas.dataInicioMA, datasRegistradas.dataFinalMA);
            } else if (estado === "RMC") {
              dentroDoPrazo = isDataDentroDoPrazo(dataProcedimento, datasRegistradas.dataInicioCARI, datasRegistradas.dataFinalCARI);
            }

            if (!dentroDoPrazo) {
              alert("Procedimento THULEP está fora do prazo");
              return;
            }
          }

          const hospital = document.getElementById("hospital").value;
          const linha = document.getElementById("linha").value;
          const horaProcedimento = document.getElementById("horaProcedimento").value;
          const carimboHorario = getCurrentTime();
          const medico = document.getElementById("medico").value;
          const nomePaciente = document.getElementById("nomePaciente").value;
          const responsabilidade = document.getElementById("responsabilidade").value;
          const vendedor = document.getElementById("vendedor").value;
          const instrumentador = document.getElementById("instrumentador").value;
          const convenio = document.getElementById("convenio").value;

          const equipamentos = [];
          const equipamentoElements = document.querySelectorAll('[name="equipamento[]"]');
          const quantidadeEquipamentoElements = document.querySelectorAll('[name="quantidadeEquipamento[]"]');
          equipamentoElements.forEach((element, index) => {
            equipamentos.push({
              nome: element.value,
              quantidade: quantidadeEquipamentoElements[index].value,
            });
          });

          const materiais = [];
          const materialElements = document.querySelectorAll('[name="material[]"]');
          const quantidadeMaterialElements = document.querySelectorAll('[name="quantidadeMaterial[]"]');
          materialElements.forEach((element, index) => {
            materiais.push({
              nome: element.value,
              quantidade: quantidadeMaterialElements[index].value,
            });
          });

          const dadosRegistro = {
            hospital,
            situacao: "Em Processo",
            motivoCancelamento: "Sem Motivo",
            estado,
            linha,
            dataProcedimento,
            horaProcedimento,
            carimboHorario,
            medico,
            nomePaciente,
            responsabilidade,
            tipoProcedimento,
            vendedor,
            instrumentador,
            convenio,
            equipamentos,
            materiais,
            imagemComunicadoUso64: "Sem comunicado de uso",
            imagemNotaFiscal64: "Sem Nota Fiscal",
            imagemRemessa64: "Sem Nota de Remessa",
            entregador: "Informe o Entregador",
          };

          fetch("https://api.itmf.app.br/registrar/enviarPedido", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(dadosRegistro),
          })
            .then(response => {
              if (response.ok) {
                alert("Registro feito com sucesso!");
              } else {
                alert("Erro ao registrar. Tente novamente.");
              }
            })
            .catch(error => {
              console.error("Erro ao registrar:", error);
              alert("Erro ao registrar. Tente novamente.");
            });
        })
        .catch(error => {
          console.error("Erro ao obter dados do usuário:", error);
          alert("Erro ao registrar. Tente novamente.");
        });
    }

    function adicionarCampo(containerId, inputName1, inputName2, label1, label2) {
    var container = document.getElementById(containerId);

    var novoCampo = document.createElement("div");
    novoCampo.classList.add("row", "mb-3");

    var divInput1 = document.createElement("div");
    divInput1.classList.add("col-md-4", "mt-2");
    var labelElement1 = document.createElement("label");
    labelElement1.htmlFor = inputName1; // Corrigido 'for' para 'htmlFor'
    labelElement1.textContent = label1;
    divInput1.appendChild(labelElement1);
    var select1 = document.createElement("select");
    select1.classList.add("form-select", "custom-select2-container");
    select1.name = inputName1;

    // Adiciona as opções filtradas
    adicionarOpcoesFiltradas(select1, inputName1);
    divInput1.appendChild(select1);
    novoCampo.appendChild(divInput1);

    var divInput2 = document.createElement("div");
    divInput2.classList.add("col-md-4", "mt-2");
    var labelElement2 = document.createElement("label");
    labelElement2.htmlFor = inputName2; // Corrigido 'for' para 'htmlFor'
    labelElement2.textContent = label2;
    divInput2.appendChild(labelElement2);
    var input2 = document.createElement("input");
    input2.type = "number";
    input2.classList.add("form-control");
    input2.name = inputName2;
    divInput2.appendChild(input2);
    novoCampo.appendChild(divInput2);

    container.appendChild(novoCampo);

    $(select1).select2();
}

function adicionarOpcoesFiltradas(selectElement, inputName) {
    // Obtém o elemento de seleção de procedimento
    var procedimentoSelect = document.getElementById('tipoProcedimento');
    
    // Verifica se o elemento de seleção de procedimento existe e tem um valor
    if (!procedimentoSelect) {
        console.error('Elemento tipoProcedimento não encontrado.');
        return;
    }
    
    var procedimentoSelecionado = procedimentoSelect.value;

    // Verifica se o valor do procedimento selecionado é válido
    if (!procedimentoSelecionado || procedimentoSelecionado === 'Selecione...') {
        console.error('Procedimento não selecionado ou inválido.');
        return;
    }

    // Defina a URL apropriada com base no tipo de input
    var tipo = inputName.includes('equipamento') ? 'EQUIPAMENTO' : 'OPME';
    var url = `https://api.itmf.app.br/item/itens?tipo=${tipo}&procedimento=${procedimentoSelecionado}`;

    fetch(url)
        .then(response => response.json())
        .then(data => {
            data.forEach(item => {
                var option = document.createElement('option');
                option.value = item.nomeItem;
                option.textContent = item.nomeItem;
                selectElement.appendChild(option);
            });

            // Re-inicializa o Select2 após adicionar as opções
            $(selectElement).select2();
        })
        .catch(error => console.error('Erro ao buscar itens:', error));
}

    function removerUltimoCampo(containerId) {
      var container = document.getElementById(containerId);
      var ultimosCampos = container.querySelectorAll(".row");
      if (ultimosCampos.length > 0) {
        container.removeChild(ultimosCampos[ultimosCampos.length - 1]);
      }
    }
  </script>
</body>

</html>